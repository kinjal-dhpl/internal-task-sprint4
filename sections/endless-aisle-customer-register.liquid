{%  render 'endless-aisle-redirection'%}
<style> 

 .custom-footer{margin-top: 0!important;}

 div.endless--container h2{

    letter-spacing: normal;

    margin-top: 0;

    text-align: center;

    font-size: 24px;

    font-family: "oregon-ldo-medium";

    color: #1c1c1c;



  }

    div.newAccont {

    display: flex;

    align-items: center;

    gap: 6px;

    justify-content: center;

    font-size: 16px;

    letter-spacing: normal;

    font-family:"oregon-ldo-medium";

  }

  div.newAccont{margin-top: 1.5rem;}

  div.newAccont a{

    text-decoration: none;

    color: #0058DB;

    margin: 0;

  }

div.newAccont p{

  color: #1c1c1c;

  margin: 0;

}

  .content-for-layout{background-color:#F6F3EF;}

  .form-field-wrap {

    margin: 1.5rem 0;

    display: flex;

    flex-direction: column;

  }

  .form-field-wrap input {

    border: 1px solid #EDEDED;

    padding: 8px;

    font-size: 16px;

    height: 40px;

    font-family: "oregon-ldo-medium";

    background-color: #F4F4F4;

}

.form-field-wrap label{

  font-size: 18px;

  color: #1c1c1c;

  font-family: "oregon-ldo-medium";

  letter-spacing: normal;

}

.form-field-wrap input:focus-visible{

  outline: 0;

  box-shadow: none;

}

 div.endless--container {

    width: 35%;

    padding: 20px;

    background-color: #fff;

    box-shadow: 0px 1px 3px 0px #1c1c1c 0001A;

    margin: 5rem auto;

  }

  button.register--btn{

    cursor: pointer;

    position: relative;

    color: #fff;

    margin: 0.5rem 0;

    font-size: 18px;

    font-family: "oregon-ldo-medium";

    line-height: 28px;

    letter-spacing: normal;

    border: 1px solid #1c1c1c;

    background: #1c1c1c;

    width: 100%;

    height: 40px;

  }



  /* snack bar css */



#snackbarError {

  visibility: hidden;

  min-width: 250px;

  margin-left: -125px;

  background-color: #bf1111;

  color: #fff;

  text-align: center;

  border-radius: 2px;

  padding: 16px;

  position: fixed;

  z-index: 1;

  left: 50%;

  bottom: 30px;

  font-size: 17px;

}



#snackbarError.show {

  visibility: visible;

  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;

  animation: fadein 0.5s, fadeout 0.5s 2.5s;

}

span.loaderOverlay{

  position: absolute;

  top: 0;

  left: 0;

  right: 0;

  bottom: 0;

  z-index: 1;

  display:none;

  justify-content: center;

  align-items: center;

  background-color:#1c1c1c;

  cursor: not-allowed;

}



span.loaderOverlay div.loader {

  border: 2.5px solid  #f1f1f1;

  border-radius: 50%;

  border-top: 2.5px solid #000;

  width: 25px;

  height: 25px;

  display: block;

  -webkit-animation: spin 1s linear infinite; /* Safari */

  animation: spin 1s linear infinite;

}

/* Safari */

@-webkit-keyframes spin {

  0% { -webkit-transform: rotate(0deg); }

  100% { -webkit-transform: rotate(360deg); }

}



@keyframes spin {

  0% { transform: rotate(0deg); }

  100% { transform: rotate(360deg); }

}





@-webkit-keyframes fadein {

  from {bottom: 0; opacity: 0;} 

  to {bottom: 30px; opacity: 1;}

}



@keyframes fadein {

  from {bottom: 0; opacity: 0;}

  to {bottom: 30px; opacity: 1;}

}



@-webkit-keyframes fadeout {

  from {bottom: 30px; opacity: 1;} 

  to {bottom: 0; opacity: 0;}

}



@keyframes fadeout {

  from {bottom: 30px; opacity: 1;}

  to {bottom: 0; opacity: 0;}

}

/* Ends Here */


@media(min-width:1100px){

  div.endless--container{width: 50%;}

}

@media only screen and (max-width: 1099px) and (min-width: 801px){

div.endless--container{width: 70%;}

}



@media only screen and (max-width: 800px) and (min-width: 476px){

div.endless--container{width: 75%;}

}



@media(max-width:475px){

  div.endless--container{width: 95%;}

}

</style>




<div class="endlessSearchContainer page-width">

  {% if section.blocks.size > 0 %}

      <div class="endless--container">

          {% if section.settings.title != blank %}

            <h2 class="sign--up-heading">{{ section.settings.title}}</h2>

          {% endif %}

        <div class="form--wrapper--endless">

          {% for block in section.blocks %}

            <div class="form-field-wrap">

          <label for="{{ block.settings.input-label}}">{{ block.settings.input-label}}{% if block.settings.required-field %}<span style="color: red;"> *</span>{% endif %}</label>

              <input type="text" id="{{ block.settings.input-label}}" name="{{block.settings.input-name}}" {% if block.settings.required-field %} required {% endif %} placeholder="{{ block.settings.placeholder}}" {% if block.settings['input-name'] == 'phone' %} maxlength="10" {% endif %}/>

            </div>

          {% endfor %}




          <button class="register--btn" onclick="collectData()">{{section.settings.buttonLabel}}<span class="loaderOverlay"><div class="loader"></div></span></button>

          <div class="newAccont"><p>Already have an account ?</p><a href="/pages/endless-aisle">Login here</a></div>

        </div>

      </div>

  {% endif %}

</div>

<div id="snackbarError"></div>

<script>

   function collectData() {

      const formWrapper = document.querySelector('.form--wrapper--endless');

      const inputs = formWrapper.querySelectorAll('input');

      const tempData = {};

      let allValid = true;



  inputs?.forEach(input => {

    const value = input.value.trim();

    const isRequired = input.hasAttribute('required');



    if (isRequired && value === '') {

      allValid = false;

      return;

    }



    tempData[input.name] = value;

  });



 

  if (allValid) {

    const formData = {

      email: tempData.email || "",

      firstName: tempData.firstName || "",

      lastName: tempData.lastName || "",

      phone: tempData.phone || "",

      addresses: {

        address1: tempData.address1 || "",

        address2: tempData.address2 || "",

        city: tempData.city || "",

        firstName: tempData.firstName || "",

        lastName: tempData.lastName || "",

        phone: tempData.phone || "",

        zip: tempData.zip || ""

      }

    };



    createCustomer(formData);

  } else {

    alert('Please fill the required * field');

  }

}





  function createCustomer(data) {

    const loaderButton = document.querySelector('span.loaderOverlay');

    if (loaderButton) {

      loaderButton.style.display = 'flex';

    }



  const myHeaders = new Headers();

  myHeaders.append("accept", "application/json");

  myHeaders.append("Content-Type", "application/json");



  const requestOptions = {

    method: "POST",

    headers: myHeaders,

    body: JSON.stringify(data),

    redirect: "follow"

  };



  fetch(`${window.EA_MODULE_BASE_URL}/customers`, requestOptions)

    .then(response => {
      if (!response.ok) {
        return response.json().then(result => {
          throw { result, statusCode: response.status };
        });
      }
      return response.json();
    })

    .then(result => {

      if (result.status === "error") {

        loaderButton.style.display = 'none';



        const errorMessage = result.errors?.[0]?.message || "Unknown error";

        console.error("Validation Error:", errorMessage);

        errorInCustomerCreation(errorMessage);

        return;

      }



      const customerID = result.data?.customer?.id;

      if (customerID) {

        successInCustomerCreation(customerID, loaderButton);

      } else {

        loaderButton.style.display = 'none';

        errorInCustomerCreation("Failed to create customer. Please try again.");

      }

    })

    .catch(error => {

      loaderButton.style.display = 'none';

      if (error.result && error.result.errors && error.result.errors.length > 0) {

        const errorMessage = error.result.errors[0].message || "Unknown error";

        errorInCustomerCreation(errorMessage);

      } else {

        errorInCustomerCreation("Server issue,Please try again later!");

      }

      console.error("Fetch error:", error);

    });

}

  



  function successInCustomerCreation(customerId ,loaderSvg){

        const actualCustomerID = customerId.split('/Customer/')[1];

        sessionStorage.setItem('EndlessAisleCustomerID',actualCustomerID);

        loaderSvg.style.display = 'none';

        location.href = '/pages/endless-aisle-customer-detail';

  }



  function errorInCustomerCreation(error) {
    let snackBarEle = document.getElementById("snackbarError");

    snackBarEle.textContent = error;

   

   snackBarEle.classList.add('show');

   setTimeout(function(){ snackBarEle.classList.remove('show'); }, 3000);

  }





</script>

{% schema %}

    {

      "name": "Endless-aisle",

      "settings": [

        {

          "type": "text",

          "id": "title",

          "label": "Section Heading",

          "default": "Search Customer"

          

        },

        {

          "type": "text",

          "id": "buttonLabel",

          "label": "Button Label",

          "default": "Register"

          

        }],

      "blocks": [

        {

            "name": "input",

             "type": "input",

             "settings":[

               {

                "type": "text",

                "id": "input-label",

                "label": "Field label" 

               },

                {

                "type": "text",

                "id": "input-name",

                "label": "field name" 

               },

               {

                "type": "checkbox",

                "id": "required-field",

                "label": "Required field",

                "default": false

               },

               {

                "type": "text",

                "id": "placeholder",

                "label": "Placeholder text" 

               }

            ]

         }

      ],

      "presets": [{ "name": "Endless-aisle-register" }]

      }

  {% endschema %}